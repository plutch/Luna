"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2194],{2194:(Y,k,a)=>{a.r(k),a.d(k,{CreateTicketPage:()=>A});var p=a(467),h=a(177),u=a(4341),c=a(7189);class j{}class v{static getNewGuid(){return`guid-${Math.floor(1e6*Math.random())}`}}var e=a(3953),C=a(8880),b=a(6037),f=a(4441);let T=(()=>{var i;class s{constructor(t,o,n,l){this.modalCtrl=t,this.navParams=o,this.commonService=n,this.AlertService=l}ngOnInit(){this.initObject();let t=this.navParams.get("data");this.ticketCode=this.navParams.get("ticketCode"),t&&(this.followupNote=t),this.userProfile=this.commonService.getUserProfile()}initObject(){this.followupNote={codigo:v.getNewGuid(),crmticket:0,crmtipo:0,detalle:"",fecha:"",nombre:"",tieneadjunto:!1,usuario:""}}cancel(){return this.modalCtrl.dismiss(null,"cancel")}save(){if(this.followupNote.nombre){if(this.followupNote.detalle)return this.followupNote.crmticket=this.ticketCode,this.followupNote.usuario=this.userProfile.usuario.codigo,this.followupNote.fecha=(new Date).toISOString(),this.modalCtrl.dismiss(this.followupNote,"save");this.AlertService.error("Favor complete el campo detalle")}else this.AlertService.error("Favor complete el campo nombre")}}return(i=s).\u0275fac=function(t){return new(t||i)(e.rXU(c.W3),e.rXU(C.y8),e.rXU(b.h),e.rXU(f.u))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-followup-note"]],standalone:!0,features:[e.aNF],decls:18,vars:4,consts:[["slot","end"],["color","danger",3,"click"],[1,"ion-padding"],["size","12","size-md","12","size-lg","6"],["type","text","label","Nombre","labelPlacement","floating",3,"ngModelChange","ngModel","clearInput"],["type","text","label","Detalle","labelPlacement","floating",3,"ngModelChange","ngModel","rows"],["expand","block","size","mediun",2,"margin-top","20px","margin-bottom","20px","margin-left","10px","margin-right","10px",3,"click"]],template:function(t,o){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return o.cancel()}),e.EFF(4,"Cancelar"),e.k0s()()()(),e.j41(5,"ion-content",2)(6,"ion-card")(7,"ion-card-header")(8,"ion-card-title"),e.EFF(9,"Seguimiento"),e.k0s()(),e.j41(10,"ion-grid")(11,"ion-row")(12,"ion-col",3)(13,"ion-input",4),e.mxI("ngModelChange",function(l){return e.DH7(o.followupNote.nombre,l)||(o.followupNote.nombre=l),l}),e.k0s()(),e.j41(14,"ion-col",3)(15,"ion-textarea",5),e.mxI("ngModelChange",function(l){return e.DH7(o.followupNote.detalle,l)||(o.followupNote.detalle=l),l}),e.k0s()()()(),e.j41(16,"ion-button",6),e.bIt("click",function(){return o.save()}),e.EFF(17,"Guardar"),e.k0s()()()),2&t&&(e.R7$(13),e.R50("ngModel",o.followupNote.nombre),e.Y8G("clearInput",!0),e.R7$(2),e.R50("ngModel",o.followupNote.detalle),e.Y8G("rows",3))},dependencies:[c.W9,c.eU,c.ai,h.MD,u.YN,u.BC,u.vS,c.Jm,c.QW,c.lO,c.ln,c.hU,c.b_,c.ME,c.tN,c.$w,c.nc]}),s})();var D=a(5079),_=a(5873),S=a(1626);let M=(()=>{var i;class s{constructor(t){this.httpClient=t}uploadFile(t){const o=new FormData;for(var n=0;n<t.length;n++)o.append("file"+n+1,t[n],t[n].name);return this.httpClient.post("upload",o)}}return(i=s).\u0275fac=function(t){return new(t||i)(e.KVO(S.Qq))},i.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"}),s})();var F=a(5569);let P=(()=>{var i;class s{constructor(t,o,n,l,m){this.modalCtrl=t,this.navParams=o,this.alertService=n,this.uploadFileService=l,this.actionSheetCtrl=m,this.selectedFile=[]}ngOnInit(){let t=this.navParams.get("data");this.ticketCode=this.navParams.get("ticketCode"),this.initObject(),t&&(this.document=t)}initObject(){this.document={codigo:v.getNewGuid(),crmticket:0,crmticketd:0,nombre:"",archivo:"",delete:!0}}cancel(){return this.modalCtrl.dismiss(null,"cancel")}onFileSelected(t){var o=this;return(0,p.A)(function*(){o.selectedFile=[],o.selectedFile.push(t.target.files[0]);const n=yield o.actionSheetCtrl.create({header:"Deseas guardar el archivo permanentemente ?",buttons:[{text:"S\xed",role:"si"},{text:"No",role:"no"}]});n.present();const{role:l}=yield n.onWillDismiss();"si"==l?o.uploadFile():o.file=""})()}uploadFile(){var t;null!==(t=this.selectedFile)&&void 0!==t&&t.length?this.uploadFileService.uploadFile(this.selectedFile).subscribe({next:o=>{this.document.archivo=o[0].filename,this.alertService.success("Documento subido con \xe9xito",2e3)},complete:()=>{},error:o=>{console.error(o)}}):this.alertService.error("Debes seleccionar un documento",2e3)}save(){if(this.document.nombre){if(this.document.crmticket=this.ticketCode,this.document.archivo)return this.modalCtrl.dismiss(this.document,"save");this.alertService.error("Debes seleccionar el archivo",2e3)}else this.alertService.error("Favor complete el campo nombre")}}return(i=s).\u0275fac=function(t){return new(t||i)(e.rXU(c.W3),e.rXU(C.y8),e.rXU(f.u),e.rXU(M),e.rXU(F.GD))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-attached-document"]],standalone:!0,features:[e.aNF],decls:19,vars:3,consts:[["slot","end"],["color","danger",3,"click"],[1,"ion-padding"],["size","12","size-md","12","size-lg","6"],["type","text","label","Nombre","labelPlacement","floating",3,"ngModelChange","ngModel","clearInput"],["type","file",3,"ngModelChange","change","ngModel"],["expand","block","size","mediun",2,"margin-top","20px","margin-bottom","20px","margin-left","10px","margin-right","10px",3,"click"]],template:function(t,o){1&t&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.bIt("click",function(){return o.cancel()}),e.EFF(4,"Cancelar"),e.k0s()()()(),e.j41(5,"ion-content",2)(6,"ion-card")(7,"ion-card-header")(8,"ion-card-title"),e.EFF(9,"Documento adjunto"),e.k0s()(),e.j41(10,"ion-grid")(11,"ion-row")(12,"ion-col",3)(13,"ion-input",4),e.mxI("ngModelChange",function(l){return e.DH7(o.document.nombre,l)||(o.document.nombre=l),l}),e.k0s()()(),e.j41(14,"ion-row")(15,"ion-col",3)(16,"ion-input",5),e.mxI("ngModelChange",function(l){return e.DH7(o.file,l)||(o.file=l),l}),e.bIt("change",function(l){return o.onFileSelected(l)}),e.k0s()()()(),e.j41(17,"ion-button",6),e.bIt("click",function(){return o.save()}),e.EFF(18,"Guardar"),e.k0s()()()),2&t&&(e.R7$(13),e.R50("ngModel",o.document.nombre),e.Y8G("clearInput",!0),e.R7$(3),e.R50("ngModel",o.file))},dependencies:[c.W9,c.eU,c.ai,h.MD,u.YN,u.BC,u.vS,c.Jm,c.QW,c.lO,c.ln,c.hU,c.b_,c.ME,c.tN,c.$w]}),s})();var N=a(6766),w=a(9109);function I(i,s){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&i){const r=e.XpG().$implicit;e.R7$(),e.SpI(" ",r.nombre," ")}}function x(i,s){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const r=e.XpG().$implicit;e.R7$(),e.SpI("",e.i5U(2,1,r.fecha,"yyyy-MM-dd h:mm a")," ")}}function G(i,s){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const r=e.XpG().$implicit;e.R7$(),e.SpI("por ",r.usuario," ")}}function R(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-icon",15),e.bIt("click",function(){e.eBV(r);const o=e.XpG().$implicit,n=e.XpG(2);return e.Njj(n.deleteFollowupNote(o))}),e.k0s()}}function y(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-item")(1,"ion-grid")(2,"ion-row")(3,"ion-col",13),e.bIt("click",function(){const o=e.eBV(r).$implicit,n=e.XpG(2);return e.Njj(n.openModalFollowupNote(o))}),e.DNE(4,I,2,1,"div",8),e.j41(5,"div"),e.DNE(6,x,3,4,"span",8)(7,G,2,1,"span",8),e.k0s()(),e.j41(8,"ion-col"),e.DNE(9,R,1,0,"ion-icon",14),e.k0s()()()()}if(2&i){const r=s.$implicit;e.R7$(4),e.Y8G("ngIf",r.nombre),e.R7$(2),e.Y8G("ngIf",r.fecha),e.R7$(),e.Y8G("ngIf",r.usuario),e.R7$(2),e.Y8G("ngIf",!r.crmtipo)}}function E(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3," Seguimiento "),e.j41(4,"ion-icon",10),e.bIt("click",function(){e.eBV(r);const o=e.XpG();return e.Njj(o.openModalFollowupNote())}),e.k0s()()(),e.j41(5,"ion-list",11),e.DNE(6,y,10,4,"ion-item",12),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(6),e.Y8G("ngForOf",r.ticket.oseguimiento)}}function U(i,s){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&i){const r=e.XpG().$implicit;e.R7$(),e.SpI(" ",r.nombre," ")}}function X(i,s){if(1&i){const r=e.RV6();e.j41(0,"span",20)(1,"ion-icon",21),e.bIt("click",function(){e.eBV(r);const o=e.XpG().$implicit,n=e.XpG(2);return e.Njj(n.deleteDocumento(o))}),e.k0s()()}}function $(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-item")(1,"ion-grid")(2,"ion-row")(3,"ion-col",13),e.bIt("click",function(){const o=e.eBV(r).$implicit,n=e.XpG(2);return e.Njj(n.openModalDocument(o))}),e.DNE(4,U,2,1,"div",8),e.k0s(),e.j41(5,"ion-col")(6,"div",17)(7,"span")(8,"ion-icon",18),e.bIt("click",function(){const o=e.eBV(r).$implicit,n=e.XpG(2);return e.Njj(n.viewDocument(o))}),e.k0s()(),e.DNE(9,X,2,0,"span",19),e.k0s()()()()()}if(2&i){const r=s.$implicit;e.R7$(4),e.Y8G("ngIf",r.nombre),e.R7$(5),e.Y8G("ngIf",r.delete)}}function O(i,s){if(1&i){const r=e.RV6();e.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-card-title"),e.EFF(3," Adjuntos "),e.j41(4,"ion-icon",10),e.bIt("click",function(){e.eBV(r);const o=e.XpG();return e.Njj(o.openModalDocument())}),e.k0s()()(),e.j41(5,"ion-list",16),e.DNE(6,$,10,2,"ion-item",12),e.k0s()()}if(2&i){const r=e.XpG();e.R7$(6),e.Y8G("ngForOf",r.ticket.oadjuntos)}}let A=(()=>{var i;class s{constructor(t,o,n,l,m,d,g){this.activatedRoute=t,this.crmService=o,this.router=n,this.commonService=l,this.alertService=m,this.modalCtrl=d,this.actionSheetCtrl=g,this.title="Nuevo ticket",this.ticket=new j,this.editionMode=!1,(0,D.a)({caretBack:_.DQR,add:_.WQq,trash:_.dco,eyeOutline:_.ov$})}ngOnInit(){this.initObject(),this.ticketCode=Number(this.activatedRoute.snapshot.paramMap.get("id")),this.customerCode=this.activatedRoute.snapshot.paramMap.get("customerCode")||"",this.userProfile=this.commonService.getUserProfile(),this.ticketCode&&(this.editionMode=!0,this.title="Editando ticket",this.getTicket(this.ticketCode)),this.enterprise=this.commonService.getUserProfile().empresa}initObject(){this.ticket={asignadoa:"",cc:"",cliente:"",codigo:0,crmestatus:0,crmgrupo:0,crmprioridad:0,crmsubgrupo:0,crmtipo:4,cxc:!1,detalle:"",doc:"",doc_rel:"",fecha:"",flimite:"",nombre:"",numero:0,num_rel:0,oadjuntos:[],oseguimiento:[],tabla:"",tablaid:0,tieneadjunto:!1,usuario:""}}close(){this.router.navigate(["servicios/solicitudes"])}getTicket(t){this.crmService.getTicket(t).subscribe({next:o=>{this.ticket=o,this.ticket.fecha=new Date(this.ticket.fecha),this.ticket.flimite=new Date(this.ticket.flimite),this.ticketCopy=JSON.stringify(this.ticket)},complete:()=>{},error:o=>{console.error(o)}})}openModalFollowupNote(t=null){var o=this;return(0,p.A)(function*(){if(null!=t&&t.codigo&&Number(t.codigo))return void o.alertService.error("El registro no puede ser modificado",2e3);const n=yield o.modalCtrl.create({component:T,componentProps:{data:t,ticketCode:o.ticketCode},backdropDismiss:!1});n.present();const{data:l,role:m}=yield n.onWillDismiss();"save"===m&&(console.log(l),o.saveFollowupNote(l))})()}saveFollowupNote(t){if(t)if(this.ticket.oseguimiento.find(n=>(null==n?void 0:n.codigo)===(null==t?void 0:t.codigo))){let n=this.ticket.oseguimiento.findIndex(l=>l.codigo===t.codigo);this.ticket.oseguimiento.splice(n,1),this.ticket.oseguimiento.unshift(t)}else this.ticket.oseguimiento.unshift(t)}deleteFollowupNote(t){var o=this;return(0,p.A)(function*(){const n=yield o.actionSheetCtrl.create({header:"Est\xe1 seguro que desea eliminar el registro ?",buttons:[{text:"S\xed",role:"si"},{text:"No",role:"no"}]});n.present();const{role:l}=yield n.onWillDismiss();if("si"==l&&t){if(o.ticket.oseguimiento.find(d=>(null==d?void 0:d.codigo)===(null==t?void 0:t.codigo))){let d=o.ticket.oseguimiento.findIndex(g=>g.codigo===t.codigo);o.ticket.oseguimiento.splice(d,1)}o.alertService.success("Registro eliminado con \xe9xito",2e3)}})()}openModalDocument(t=null){var o=this;return(0,p.A)(function*(){if(null!=t&&t.codigo&&Number(t.codigo))return void o.alertService.error("El registro no puede ser modificado",2e3);const n=yield o.modalCtrl.create({component:P,componentProps:{data:t,ticketCode:o.ticketCode},backdropDismiss:!1});n.present();const{data:l,role:m}=yield n.onWillDismiss();"save"===m&&o.saveDocument(l)})()}saveDocument(t){if(t)if(this.ticket.oadjuntos.find(n=>(null==n?void 0:n.codigo)===(null==t?void 0:t.codigo))){let n=this.ticket.oadjuntos.findIndex(l=>l.codigo===t.codigo);this.ticket.oadjuntos.splice(n,1),this.ticket.oadjuntos.unshift(t)}else this.ticket.oadjuntos.unshift(t)}viewDocument(t){window.open(this.enterprise.cdn+t.archivo,"_blank")}deleteDocumento(t){var o=this;return(0,p.A)(function*(){const n=yield o.actionSheetCtrl.create({header:"Est\xe1 seguro que desea eliminar el registro ?",buttons:[{text:"S\xed",role:"si"},{text:"No",role:"no"}]});n.present();const{role:l}=yield n.onWillDismiss();if("si"==l&&t){if(o.ticket.oadjuntos.find(d=>(null==d?void 0:d.codigo)===(null==t?void 0:t.codigo))){let d=o.ticket.oadjuntos.findIndex(g=>g.codigo===t.codigo);o.ticket.oadjuntos.splice(d,1)}o.alertService.success("Registro eliminado con \xe9xito",2e3)}})()}save(){if(this.editionMode){if(this.ticketCopy==JSON.stringify(this.ticket))return void this.close();this.crmService.updateTicket(this.ticket).subscribe({next:t=>{this.alertService.success("Registro actualizado con \xe9xito",2e3),this.close()},complete:()=>{},error:t=>{console.error(t)}})}else this.ticket.cliente=this.customerCode,this.ticket.usuario=this.userProfile.usuario.codigo,this.crmService.createTicket(this.ticket).subscribe({next:t=>{this.alertService.success("Registro creado con \xe9xito",2e3),this.close()},complete:()=>{},error:t=>{console.error(t)}})}}return(i=s).\u0275fac=function(t){return new(t||i)(e.rXU(N.nX),e.rXU(w.u),e.rXU(N.Ix),e.rXU(b.h),e.rXU(f.u),e.rXU(c.W3),e.rXU(F.GD))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-create-ticket"]],standalone:!0,features:[e.aNF],decls:24,vars:9,consts:[[3,"translucent"],["slot","start"],["slot","end"],["color","danger",3,"click"],[3,"fullscreen"],["size","12","size-md","12","size-lg","6"],["type","text","label","Nombre","labelPlacement","floating",3,"ngModelChange","ngModel","clearInput"],["type","text","label","Detalle","labelPlacement","floating",3,"ngModelChange","ngModel","rows"],[4,"ngIf"],["expand","block","size","mediun",2,"margin-top","30px","margin-bottom","20px","margin-left","10px","margin-right","10px",3,"click"],["name","add",2,"float","right",3,"click"],["lines","full",1,"list-scroll"],[4,"ngFor","ngForOf"],[3,"click"],["name","trash-outline","size","small","color","danger","style","float: right",3,"click",4,"ngIf"],["name","trash-outline","size","small","color","danger",2,"float","right",3,"click"],["lines","full",1,"list-scroll-document"],[2,"text-align","right"],["name","eye-outline",3,"click"],["style","margin-left: 30px;",4,"ngIf"],[2,"margin-left","30px"],["color","danger","name","trash-outline",3,"click"]],template:function(t,o){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.nrm(3,"ion-menu-button"),e.k0s(),e.j41(4,"ion-buttons",2)(5,"ion-button",3),e.bIt("click",function(){return o.close()}),e.EFF(6,"Cancelar"),e.k0s()(),e.j41(7,"ion-title"),e.EFF(8),e.k0s()()(),e.j41(9,"ion-content",4)(10,"ion-card")(11,"ion-card-header")(12,"ion-card-title"),e.EFF(13,"Datos generales"),e.k0s()(),e.j41(14,"ion-grid")(15,"ion-row")(16,"ion-col",5)(17,"ion-input",6),e.mxI("ngModelChange",function(l){return e.DH7(o.ticket.nombre,l)||(o.ticket.nombre=l),l}),e.k0s()(),e.j41(18,"ion-col",5)(19,"ion-textarea",7),e.mxI("ngModelChange",function(l){return e.DH7(o.ticket.detalle,l)||(o.ticket.detalle=l),l}),e.k0s()()()()(),e.DNE(20,E,7,1,"ion-card",8)(21,O,7,1,"ion-card",8),e.j41(22,"ion-button",9),e.bIt("click",function(){return o.save()}),e.EFF(23,"Guardar"),e.k0s()()),2&t&&(e.Y8G("translucent",!0),e.R7$(8),e.JRh(o.title),e.R7$(),e.Y8G("fullscreen",!0),e.R7$(8),e.R50("ngModel",o.ticket.nombre),e.Y8G("clearInput",!0),e.R7$(2),e.R50("ngModel",o.ticket.detalle),e.Y8G("rows",3),e.R7$(),e.Y8G("ngIf",o.editionMode),e.R7$(),e.Y8G("ngIf",o.editionMode))},dependencies:[c.W9,c.eU,c.BC,c.ai,h.MD,h.Sq,h.bT,h.vh,u.YN,u.BC,u.vS,c.Jm,c.QW,c.MC,c.uz,c.nf,c.lO,c.ln,c.hU,c.b_,c.ME,c.tN,c.$w,c.nc,c.iq],styles:[".list-scroll[_ngcontent-%COMP%]{height:250px;overflow-y:scroll;scroll-behavior:smooth}.list-scroll-document[_ngcontent-%COMP%]{height:150px;overflow-y:scroll;scroll-behavior:smooth}"]}),s})()}}]);